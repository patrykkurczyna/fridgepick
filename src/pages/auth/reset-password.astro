---
import AuthLayout from '../../layouts/AuthLayout.astro';
import { ResetPasswordForm } from '../../components/auth/ResetPasswordForm';

const title = 'Ustaw nowe hasło';

// Get code from query params (from email link)
const code = Astro.url.searchParams.get('code');

// If we have a code, middleware will exchange it for a recovery session
// If no code and no session, user accessed this page directly - redirect to login
if (!code && !Astro.locals.session) {
  return Astro.redirect('/auth/login?error=invalid_reset_link');
}

// At this point, we either have:
// 1. A code that will be exchanged for a session by middleware
// 2. An existing recovery session
// Either way, show the reset password form
---

<AuthLayout title={title}>
  <ResetPasswordForm client:load />

  <div slot="footer">
    <p class="text-gray-500">
      Pamiętasz hasło?{' '}
      <a
        href="/auth/login"
        class="text-emerald-600 hover:text-emerald-500 transition-colors font-medium"
      >
        Zaloguj się
      </a>
    </p>
  </div>
</AuthLayout>
