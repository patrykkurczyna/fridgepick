---
import AuthLayout from '../../layouts/AuthLayout.astro';
import { ResetPasswordForm } from '../../components/auth/ResetPasswordForm';

const title = 'Ustaw nowe hasło';

// Pobierz token z query params
const token = Astro.url.searchParams.get('token');
const type = Astro.url.searchParams.get('type');

// TODO: Po implementacji middleware - sprawdź czy użytkownik już zalogowany
// const session = await Astro.locals.supabase.auth.getSession();
// if (session.data.session) {
//   return Astro.redirect('/fridge');
// }

// Walidacja tokenu (musi być obecny i type musi być 'recovery')
if (!token || type !== 'recovery') {
  return Astro.redirect('/auth/login?error=invalid_reset_link');
}
---

<AuthLayout title={title}>
  <ResetPasswordForm client:load token={token} />

  <div slot="footer">
    <p class="text-gray-500">
      Pamiętasz hasło?{' '}
      <a
        href="/auth/login"
        class="text-emerald-600 hover:text-emerald-500 transition-colors font-medium"
      >
        Zaloguj się
      </a>
    </p>
  </div>
</AuthLayout>
