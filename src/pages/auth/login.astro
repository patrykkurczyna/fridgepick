---
import AuthLayout from '../../layouts/AuthLayout.astro';
import { LoginForm } from '../../components/auth/LoginForm';

const title = 'Logowanie';

// Check if user just logged out (from reset password flow)
const justLoggedOut = Astro.url.searchParams.get('logged_out') === 'true';

// Check if user is already logged in (unless they just logged out)
if (Astro.locals.session && !justLoggedOut) {
  // User is already authenticated, redirect to fridge or the original destination
  const redirectTo = Astro.url.searchParams.get('redirect');
  if (redirectTo) {
    return Astro.redirect(decodeURIComponent(redirectTo));
  }
  return Astro.redirect('/fridge');
}

// Opcjonalny parametr redirect z URL
const redirectTo = Astro.url.searchParams.get('redirect');
---

<AuthLayout title={title}>
  <LoginForm client:load redirectTo={redirectTo} />

  <div slot="footer">
    <p class="text-gray-500">
      Wróć do{' '}
      <a
        href="/"
        class="text-emerald-600 hover:text-emerald-500 transition-colors font-medium cursor-pointer"
      >
        strony głównej
      </a>
    </p>
  </div>
</AuthLayout>
